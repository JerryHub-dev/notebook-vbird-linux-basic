# 09. vim 程序编辑器

## 9.1 vi 与 vim

在 Linux 中，绝大部分配置文件都是以 ASCII 的纯文本文件形式存在，因此利用简单的文字编辑软件就能够修改配置。<br />使用 vi 的原因：

- 所有 UNIX-like 系统都会内置 vi 文本编辑器，其他的文本编辑器不一定存在
- **所有软件的编辑接口都会主动调用 vi**
- 程序简单，执行速度快

vim 是 vi 的升级版，有更丰富的功能，可以作为程序编辑器。

## 9.2 vi 的使用

### vi 三种模式

- 一般命令模式（command mode）
- 编辑模式（insert mode）
- 命令行模式（command-line mode）

三种模式的相互关系

### vi 按键说明

## 9.3 vim

### vim 额外功能

- 颜色显示
- 支持程序语法
- 可视区块（Visual Block）
  - v、V、[Ctrl]-v
- 多文件编辑
  - :n、:N、:files
- 多窗口编辑
  - :sp
- 关键词补全

### vim 常用命令示意

### vim 的缓存、恢复与打开时的警告信息

在使用 vim 编辑时，会在被编辑文件的目录下，建立一个 .filename.swap 的缓存文件。<br />当 vim 由于异常中断时，缓存无法由正常流程来结束，所以缓存不会消失，而继续保留。<br />当缓存存在，再次打开文件时，会提示错误情况，可根据实际情况解决。

### vim 操作记录

操作记录文件：~/.viminfo

### vim 环境设置

- 在一般命令模式中输入对应命令
- 或者编辑环境设置文件：~/.vimrc（默认不存在，可手动创建）

## 9.4 其他 vim 使用注意事项

### 中文编码问题

可能的原因：

- Linux 默认支持的语系数据：与 /etc/locale.conf 有关
- 终端的语系：与 LANG、LC_ALL 几个变量有关
- 文件原本的编码
- 打开终端的软件，例如在 GNOME 下的窗口界面

### DOS 与 Linux 的换行符

换行符：

- DOS（Windows 系统）
  - ^M$（CR 与 LF 两个符号）
- Linux
  - 仅有 $（LF）

> 注意：由于 Linux 执行命令的依据是【回车】，换行符不同，会导致 Linux 下执行 shell 脚本失败!

可以使用【dos2unix】及【unix2dos】变更文件每一行的换行符：

```bash
$ dos2unix [-kn] file [newfile]
$ unix2dos [-kn] file [newfile]

# 选项与参数
# -k：保留该文件原本的 mtime 时间格式
# -n：保留原本的旧文件，将转换后的内容输出到新文件
```

:::warning
注意：

- 不建议在 Windows 系统中将文件编辑好之后，才上传到 Linux 系统，容易发生错误
- 不同系统之间复制纯文本文件时，一定要转换换行格式
  :::

### 语系编码转换

【iconv】 命令

```bash
$ iconv -f 原本编码 -t 新编码 filename [-o newfile]

# 示例

# 将 /tmp/vitest/vi.big5 转换成 UTF-8 编码
$ cd /tmp/vitest
$ iconv -f big5 -t utf8 vi.big5 -o vi.utf8
```
