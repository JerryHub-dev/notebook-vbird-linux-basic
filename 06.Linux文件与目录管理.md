# 06. Linux 文件与目录管理

## 6.1 目录与路径

### 6.1.1 绝对路径与相对路径

- 由根目录/开始的路径为绝对路径，否则为相对路径
- 在相近工作目录时，相对路径较为方便
- 在写程序（shell 脚本）管理系统时，建议使用绝对路径

### 6.1.2 目录的相关操作

```bash
.           代表此层目录
..          代表上一层目录
-           代表前一个工作目录
~           代表当前使用者身份所在的家目录
~account    代表 account 这个使用者的家目录
```

:::warning
特别注意：

- 在所有目录下都会存在的两个目录：“.” 与 “..”
- 根目录的上一层（..）与根目录自己（.）是同一个目录
  :::

#### 6.1.2.1 cd（change directory，切换目录）

```bash
$ cd [相对路径或绝对路径]

# 示例

# 进入 test 用户的家目录 /home/test
$ cd ~test

# 回到自己的家目录
$ cd ~

# 不加任何路径，也是回到自己的家目录
$ cd

# 到当前的上层目录
$ cd ..

# 回到刚刚的目录
$ cd -

# 绝对路径
$ cd /var/spool/mail

# 相对路径
$ cd ../postfix
```

#### 6.1.2.2 pwd（print working directory，显示当前所在的目录）

```bash
$ pwd [-P]

# 选项与参数
# -P：显示出真正的路径，而非使用链接（link）路径

# 示例
$ pwd

$ pwd -P
```

#### 6.1.2.3 mkdir（make directory，建立新目录）

```bash
$ mkdir [-mp] 目录名称

# 选项与参数
# -m：设置文件的权限，直接设置，不使用默认权限（umask）
# -p：递归创建目录

# 示例

$ mkdir test

$ mkdir -p test1/test2/test3/test4

$ mkdir -m 711 test2
```

#### 6.1.2.4 rmdir（remove empty directory，删除“空”目录）

```bash
$ rmdir [-p] 空目录名称

# 选项与参数
# -p：递归删除空目录

# 示例

$ rmdir test

$ rmdir -p test1/test2/test3/test4
```

:::warning
注意：能删除的是空目录；如果不是，需要通过【rm -r test】
:::

### 6.1.3 关于执行文件路径的变量：$PATH

当在执行一个命令时，系统会依据 PATH 的设置去每个 PATH 定义的目录中查找对应文件名的可执行文件。如果在 PATH 定义的目录中含有多个对应文件名的可执行文件，执行的是先查找到的同名命令。

```bash
$ echo $PATH
```

- 不同身份用户默认的 PATH 不同，默认能够随意执行的命令也不同
- PATH 是可以修改的
- 使用绝对路径或相对路径直接指定某个命令的文件名来执行，会比查找 PATH 来的正确
- 命令应该要放置在正确的目录下
- 本目录（.）最好不要放到 PATH 中

## 6.2 文件与目录管理

### 6.2.1 ls（list，文件与目录的查看）

```bash
$ ls [-aAdfFhilnrRSt] 文件名或目录名
$ ls [--color={never,auto,always}] 文件名或目录名
$ ls [--full-time] 文件名或目录名

# 重要参数
# -a：全部的文件，包含隐藏文件
# -d：仅列出目录本身，而不是列出目录内的文件数据
# -l：详细信息展示

# 示例

# 将家目录下的所有文件列出来（含属性与隐藏文件）
$ ls -al ~

# 不显示颜色，但显示该文件名代表的类型
$ ls -alF --color=never ~

# 完整显示文件的修改时间
$ ls -al --full-time ~
```

【ls -l】可以缩写为【ll】

### 6.2.2 复制、删除、移动

#### 6.2.2.1 cp（copy，复制）

cp 作用：

- 复制文件
- 建立链接文件
- 对比两文件的新旧而更新
- 复制整个目录

```bash
$ cp [-adfilprsu] 源文件（source） 目标文件（destination）
$ cp [options] source1 source2 source3 ... directory

# 常用选项
# -a：相当于 -dr --preserve=all
# -d：若源文件为链接文件的属性，则复制链接文件属性而非文件本身
# -i：若目标文件已经存在时，在覆盖时会先询问操作的进行
# -p：连同文件的属性（权限、用户、时间）一起复制，而非使用默认属性（备份常用）
# -r：递归复制，用于目录的复制

# 示例

# 复制
$ cp ~/.bashrc /tmp/bashrc

# 覆盖提示
$ cp -i ~/.bashrc /tmp/bashrc

# 复制目录，注意 .
$ cp /var/log/wtmp .

# 默认的复制会修改文件的属性、权限
# 如果要完全复制源文件所有特性，需要 -a
$ cp -a /var/log/wtmp wtmp2

# 复制目录下的所有内容，-r
$ cp -r /etc/ /tmp
# 注意：文件与目录的权限可能会被改变

# 创建链接文件
# 符号链接（symbolic link）（快捷方式）
$ cp -s bashrc bashrc_slink
# 硬链接（hard link）
$ cp -l bashrc bashrc_hlink

# 对比文件，如果有差异才复制
$ cp -u ~/.bashrc /tmp/bashrc

# 如果是链接文件，默认会复制实际文件；如果要复制链接文件的属性，需要 -d
$ cp bashrc_slink bashrc_slink_1
$ cp -d bashrc_slink bashrc_slink_1

# 可以一次复制多个文件到同一目录，最后面的是目标目录
$ cp ~/.bashrc ~/.bashrc_history /tmp
```

#### 6.2.2.2 rm（remove，删除文件或目录）

```bash
$ rm [-fir] 文件或目录

# 选项与参数
# -f：force，忽略不存在的文件，不会出现警告信息
# -i：删除前会询问
# -r：递归删除，常用于目录的删除，非常危险的选项！

# 示例

# 删除前询问
$ rm -i bashrc

# 使用通配符
$ rm -i bashrc*

# 删除目录
$ rm -r /tmp/etc

# 删除带 - 开头的文件
$ rm ./-aaa-
# 或者
$ rm -- -aaa-
```

#### 6.2.2.3 mv（move，移动文件与目录，或重命名）

```bash
$ mv [-fiu] source destination
$ mv [options] source1 source2 source3 ... directory

# 选项与参数
# -f：force，如果目标文件已存在，不会询问而直接覆盖
# -i：如果目标文件已存在，询问是否覆盖
# -u：如果目标文件已存在，且 source 比较新，才会更新

# 示例

# 移动文件到某个目录
$ mv bashrc mvtest

# 重命名
$ mv mvtest mvtest2

# 移动多个文件
$ mv bashrc1 bashrc2 mvtest2
```

### 6.2.3 获取路径的文件名与目录名称

```bash
# 获取路径的文件名
$ basename /etc/sysconfig/network
# network

# 获取路径的目录名
$ dirname /etc/sysconfig/network
# /etc/sysconfig
```

## 6.3 文件内容查看

### 6.3.1 直接查看文件内容

#### 6.3.1.1 cat（concatenate，串联）

```bash
$ cat [-AbEnTv]

# 示例

# 查看文件
$ cat /etc/issue

# 打印行号
$ cat -n /etc/issue

# 完整显示内容（含特殊字符），[tab]以 ^I 表示，换行符以 $ 表示
$ cat -A /etc/man_db.conf
```

#### 6.3.1.2 tac（反向列示）

```bash
# 与 cat 相反
$ tac /etc/issue
```

#### 6.3.1.3 nl（添加行号打印）

```bash
$ nl [-bnw] 文件

# 示例

# 列出内容
$ nl /etc/issue

# 空白行也添加行号
$ nl -b a /etc/issue

# 行号自动补 0
$ nl -b a -n rz /etc/issue
```

### 6.3.2 可翻页查看

#### 6.3.2.1 more（一页一页翻动）

```bash
$ more /etc/man_db.conf
```

如果 more 后面接的文件内容行数大于屏幕输出行数，最后一行会显示百分比

在最后一行可输入的命令：

- 空格键：向下翻一页
- Enter：向下翻一行
- b 或 [ctrl]-b：往回翻页
- /：在显示的内容中，向下查找字符串
- :f：立刻显示出文件名及目前显示的行数
- q：离开

#### 6.3.2.2 less（一页一页翻动）

```bash
$ less /etc/man_db.conf
```

在最后一行可输入的命令：

- 空格键：向下翻一页
- [pagedown]：向下翻一页
- [pageup]：向上翻一页
- /：向下查找字符串
- ?：向上查找字符串
- n：重复前一个查找
- N：反向重复前一个查找
- g：前进到这个数据的第一行
- G：前进到这个数据的最后一行
- q：离开

【man】命令是调用的【less】来显示说明文件的内容

### 6.3.3 数据截取

#### 6.3.3.1 head（取出前面几行）

```bash
$ head [-n number] 文件

# 示例

# 默认显示前 10 行
$ head /etc/man_db.conf

# 显示前 20 行
$ head -n 20 /etc/man_db.conf

# 后面的 100 行都不打印
$ head -n -100 /etc/man_db.conf
```

#### 6.3.3.2 tail（取出后面几行）

```bash
$ tail [-n number] 文件

# 示例

# 默认显示最后 10 行
$ tail /etc/man_db.conf

# 显示最后 20 行
$ tail -n 20 /etc/man_db.conf

# 只列出 100 行之后的数据
$ tail -n +100 /etc/man_db.conf

# 持续检测内容，直到 [ctrl]-c 退出
$ tail -f /var/log/messages
```

### 6.3.4 非纯文本文件：od

```bash
$ od [-t TYPE] 文件

# 示例

# 使用 ASCII 方式显示
$ od -t c /usr/bin/passwd

# 以八进制列出存储值与 ASCII 的对照表
$ od -t oCc /etc/issue
```

### 6.3.5 修改文件时间或创建新文件：touch

文件的三个主要时间参数：

- 修改时间（modification time，mtime）
  - 当该文件的【内容数据】变更时，会更新。内容数据指的是文件的内容，而不是文件的属性或权限
- 状态时间（status time，ctime）
  - 当该文件的【状态】改变时，会更新。如：权限、属性变更
- 读取时间（access time，atime）
  - 当该文件的【内容被读取】时，会更新

```bash
$ touch [-acdmt] 文件

# 选项与参数
# -a：仅自定义 access time
# -c：仅修改文件的时间，若该文件不存在则不建立新文件
# -d：可以设置自定义日期而不用当前日期
# -m：仅修改 mtime
# -t：可以设置自定义日期而不用当前日期，格式为[YYYYMMDDhhmm]

# 示例

# 新建一个空文件
$ touch testtouch
# 默认情况下，如果 touch 后有接文件，则该文件的三个时间都会更新为当前时间
# 如果该文件不存在，则会创建一个新文件

# 修改文件时间为两天前
$ touch -d "2 days ago" bashrc

# 修改文件日期
$ touch -t 202209252113 bashrc
```

touch 命令最常被使用的情况：

- 建立一个空文件
- 将某个文件日期自定义为当前（mtime、atime）

## 6.4 文件与目录的默认权限与隐藏权限

### 6.4.1 文件默认权限：umask

【umask】指定目前用户在建立文件或目录时的权限默认值。

文件与目录的默认权限：

- 若为文件，默认权限为【-rw-rw-rw-】（666）
- 若为目录，默认权限为【drwxrwxrwx】（777）
  > umask 的数字指的是该默认值需要减掉的权限

查看当前的 umask 值：

```bash
$ umask
# 0022，与一般权限有关的是后面三个数字

# 或
$ umask -S
# u=rwx,g=rx,o=rx
```

修改 umask 值：

```bash
# 示例
$ umask 002
```

### 6.4.2 文件隐藏属性

#### 6.4.2.1 chattr（配置文件隐藏属性）

```bash
$ chattr [+-=] [ASacdistu] 文件或目录

# 重要参数
# a：文件只能增加数据，而不能修改数据，只有 root 才能设置该属性
# i：可以让一个文件不能被删除、改名、设置链接也无法写入或新增数据，只有 root 才能设置该属性

# 注意 + - ，可以增加/删除属性
```

#### 6.4.2.2 lsattr（显示文件隐藏属性）

```bash
$ lsattr [-adR] 文件或目录
```

:::warning
注意：chattr 与 lsattr 在使用时必须特别小心！
:::

### 6.4.3 文件特殊权限：SUID、SGID、SBIT

#### 6.4.3.1 Set UID

当【s】标志出现在【文件拥有者】的【x】权限上时（如【-rwsr-xr-x】），被称为 Set UID，简称为 SUID 特殊权限。

SUID 的限制与功能：

- 仅对二进制程序有效
- 执行者对于该程序需要具有【x】的可执行权限
- 本权限仅在执行该程序的过程中有效
- 执行者将具有该程序【拥有者】的权限
- 对目录无效

#### 6.4.3.2 Set GID

当【s】标志出现在【用户组】的【x】权限上时（如【-rwxr-sr-x】），被称为 Set GID，简称为 SGID 特殊权限。

SGID 的限制与功能：

- 如果是文件：
  - 对二进制程序有用
  - 程序执行者对于该程序来说，需具备【x】的权限
  - 执行者在执行过程中将获得该程序【用户组】的支持
- 如果是目录：
  - 用户若对于此目录具有【r】与【x】权限时，该用户能够进入此目录
  - 用户在此目录下的【有效用户组】将变成该目录的用户组
  - 用途：若用户在此目录下具有【w】权限，则用户所建立的新文件，该新文件的用户组与此目录的用户组相同

#### 6.4.3.3 Sticky Bit

如【-rwxr-xr-t】
SBIT 的限制与功能：

- 只对目录有效
- 当用户对于此目录具有【w】【x】权限，即具有写入的权限
- 当用户在该目录下建立文件或目录时，仅有自己与 root 才有权利删除该文件

#### 6.4.3.4 SUID/SGID/SBIT 权限设置

1、数字法
在原来权限的三个数字之前再加一位数字：

- SUID：4
- SGID：2
- SBIT：1
  > 如【-rwsr-xr-x】对应 4755

2、符号法

- SUID：u+s
- SGID：g+s
- SBIT：o+t
  :::warning
  注意：S、T 代表权限为空
  :::

### 6.4.4 观察文件类型：file

```bash
# 示例
$ file ~/.bashrc
```

## 6.5 命令与文件的查找

### 6.5.1 脚本文件的查找

#### 6.5.1.1 which（查找【执行文件】）

```bash
$ which [-a] command

# 示例
$ which ifconfig
```

这个命令是根据【PATH】环境变量所规范的路径，去查找执行文件的文件名。重点是找出执行文件而已，且后面接的是完整文件名。

### 6.5.2 文件的查找

#### 6.5.2.1 whereis（由一些特定的目录中查找文件）

```bash
$ whereis [-bmsu] 文件或目录

## 示例
$ whereis passwd
```

#### 6.5.2.2 locate（从数据库查找）

```bash
$ locate [-iclSr] [keyword]

# 示例

# 找出系统中所有与 passwd 相关的文件名，且只列出 5 个
$ locate -l 5 passwd

# 列出 locate 查询所使用的数据库文件、文件名及各数据总量
$ locate -S
```

【locate】从已建立的数据库 /var/lib/mlocate 查找。
限制：数据库的建立默认是每天执行一次。如果有新建立的文件，则可能会找不到。
手动更新数据库：【updatedb】

#### 6.5.2.3 find（从硬盘查找）

```bash
$ find [PATH] [option] [action]

# 选项及参数
# 1. 与时间有关的选项：
#		-atime、-ctime、-mtime，以 -mtime 为例：
#		-mtime n
#		-mtime +n
#		-mtime -n
# 	-newer file

# 查询过去 24 小时内有修改过内容的文件
$ find / -mtime 0

# 查询 /etc 下面的文件，如果文件日期比 /etc/passwd 新就列出
$ find /etc -newer /etc/passwd

# 2. 与使用者或用户组名称有关的参数：
# 	-uid n
#		-gid n
# 	-user name
# 	-group name
#		-nouser
#		-nogroup

# 查找 /home 下属于 test 用户的文件
$ find /home -user test

# 查找系统中不属于任何人的文件
$ find / -nouser

# 3. 与文件权限及名称有关的参数：
# 	-name filename
# 	-size 【+-】SIZE
# 	-type TYPE
# 	-perm -mode
# 	-perm /mode

# 查找文件名为 passwd 的文件
$ find / -name passwd

# 查找文件名包含 passwd 的文件
$ find / -name "*passwd*"

# 查找文件类型为 socket 的文件
$ find / -type s

# 查找文件中含有 SGID、SUID 或 SBIT 属性的文件
$ find / -perm /7000

# 4. 额外可进行的操作
# 	-exec commond
#		-print

# 将找到的文件用 ls -l 列出来
$ find / -perm /7000 -exec ls -l {} \;
# {} 代表的是由 find 找到的内容
# exec 一直到 \; 是关键词，代表 find 额外可操作的开始到结束，在这中间的就是额外操作
# \; 为转义的 ;
```
