# 13.1 Linux 的账号与用户组

## 13.1.1 用户标识符：UID 与 GID

Linux 操作系统中，关于账号与用户组，记录的是 UID/GID 的数字。<br />每个登录的用户至少都会获得两个 ID：

- UID：User ID
- GID：Group ID

对应信息分别保存在 /etc/passwd 与 /etc/group 文件中。

## 13.1.2 用户账号

用户在登录过程中，输入账号密码，系统的处理过程：

- 1、先查找 /etc/passwd 中是否有输入的账号
  - 如果没有，直接退出
  - 如果有，则读取该账号对应的 UID 与 GID（在 /etc/group 中），另外，也一并读取该账号的家目录与 shell 设置
- 2、核对密码表
  - 在 /etc/shadow 中找出对应的账号与 UID，然后核对输入的密码与用户密码是否相符
- 3、进入 shell 管理

### /etc/passwd 文件

记录用户 UID 与 GID 等重要参数信息。

```bash
# head -n 4 /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
```

每一行都代表一个账号。

> 注意：有很多是系统账号

每一行中的信息以【:】分隔为 7 个字段：

- 1、账号名称
- 2、密码
  - 已经移动到 /etc/shadow 文件中，因此都为【x】
- 3、UID
  - 0：系统管理员
  - 1~999：系统账号
  - > = 1000：可登录账号
- 4、GID
- 5、用户信息说明栏
- 6、家目录
- 7、shell

### /etc/shadow 文件

账号密码文件，仅 root 可以修改。

```bash
# head -n 4 /etc/shadow
root:$6$wtbCCce/PxMeE5wm$KE2IfSJr.YLP7Rcai6oa/T7KFhO...:16559:0:99999:7:::
bin:*:16372:0:99999:7:::
daemon:*:16372:0:99999:7:::
adm:*:16372:0:99999:7:::
```

每一行中的信息以【:】分隔为 9 个字段：

- 1、账号名称
- 2、密码
  - 开头为【!】或【\*】表示失效密码
- 3、最近修改密码的日期
- 4、密码不可被修改的天数（与第三字段相比）
- 5、密码需要重新修改的天数（与第三字段相比）
- 6、密码需要修改期限前的警告天数（与第五字段相比）
- 7、密码过期后的账号宽限时间（密码失效日）（与第五字段相比）
- 8、账号失效日期
- 9、保留

## 13.1.3 关于用户组：有效与初始用户组，groups，newgr

### /etc/group 文件

记录 GID 与组名的对应记录。

```bash
# head -n 4 /etc/group
root:x:0:
bin:x:1:
daemon:x:2:
sys:x:3:
```

每一行代表一个用户组，以【:】分隔为 4 个字段：

- 1、组名
- 2、用户组密码
  - 已经移动到 /etc/gshadow 文件中，因此都为【x】
- 3、GID
- 4、此用户组支持的账号名称
  - 多个账号以【,】分隔，不能有空格

### /etc/gshadow 文件

```bash
# head -n 4 /etc/gshadow
root:::
bin:::
daemon:::
sys:::
```

每一行代表一个用户组，以【:】分隔为 4 个字段：

- 1、组名
- 2、用户组密码
  - 为空或者开头为【!】，表示无用户组管理员
- 3、用户组管理员的账号
- 4、此用户组支持的账号名称

gshadow 最大的功能就是建立用户组管理员。

### 有效用户组与初始用户组

用户可以支持多个用户组：

- 初始用户组：用户登录时主动获取到的用户组，即 /etc/passwd 的第四个字段
- 有效用户组：在新建文件时会影响新文件用户组

### groups：有效与支持用户组的观察

```bash
$ groups
```

第一个输出的用户组为有效用户组。

### newgrp：有效用户组的切换

```bash
$ newgrp 用户组名
```

注意：

- 要切换的用户组必须是当前用户已经有的用户组
- 是以另外一个 shell 来提供的功能，结束后记得 `exit` 退出 newgrp 的环境
